
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Riemannian Low-rank Matrix Completion algorithm on Movielens dataset &#8212; &lt;h1 style=&#34;font-size:1.7em;text-align:center;color:#FF5733&#34;&gt;Recommenders&lt;/h1&gt;</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/tabs.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title"><h1 style="font-size:1.7em;text-align:center;color:#FF5733">Recommenders</h1></h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p class="caption" role="heading">
 <span class="caption-text">
  Quick Start
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="als_movielens.html">
   Running ALS on MovieLens (PySpark)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ncf_movielens.html">
   Neural Collaborative Filtering on MovieLens dataset.
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="fastai_movielens.html">
   FastAI Recommender
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Deep Dive
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../02_model_collaborative_filtering/als_deep_dive.html">
   Spark Collaborative Filtering (ALS) Deep Dive
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../02_model_collaborative_filtering/baseline_deep_dive.html">
   Estimating Baseline Performance
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  API Documentation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../source/datasets.html">
   Dataset module
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../source/evaluation.html">
   Evaluation module
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../source/models.html">
   Recommender algorithms module
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../source/tuning.html">
   Hyperparameter tuning module
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../source/utils.html">
   Common utilities module
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/examples/00_quick_start/rlrmc_movielens.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/microsoft/recommenders"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/microsoft/recommenders/issues/new?title=Issue%20on%20page%20%2Fexamples/00_quick_start/rlrmc_movielens.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/microsoft/recommenders/main?urlpath=tree/docs/examples/00_quick_start/rlrmc_movielens.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#download-the-movielens-dataset">
   1. Download the MovieLens dataset
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#split-the-data-using-the-spark-chronological-splitter-provided-in-utilities">
   2. Split the data using the Spark chronological splitter provided in utilities
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#train-the-rlrmc-model-on-the-training-data">
   3. Train the RLRMC model on the training data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#obtain-predictions-from-the-rlrmc-model-on-the-test-data">
   4. Obtain predictions from the RLRMC model on the test data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#evaluate-how-well-rlrmc-performs">
   5. Evaluate how well RLRMC performs
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reference">
   Reference
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <p><em>Copyright (c) Microsoft Corporation. All rights reserved.</em></p>
<p><em>Licensed under the MIT License.</em></p>
<div class="section" id="riemannian-low-rank-matrix-completion-algorithm-on-movielens-dataset">
<h1>Riemannian Low-rank Matrix Completion algorithm on Movielens dataset<a class="headerlink" href="#riemannian-low-rank-matrix-completion-algorithm-on-movielens-dataset" title="Permalink to this headline">¶</a></h1>
<p>Riemannian Low-rank Matrix Completion (RLRMC) is a matrix factorization based (vanilla) matrix completion algorithm that solves the optimization problem using Riemannian conjugate gradients algorithm (Absil et al., 2008). RLRMC is based on the works by Jawanpuria and Mishra (2018) and Mishra et al. (2013).</p>
<p>The ratings matrix of movies (items) and users is modeled as a low-rank matrix. Let the number of movies be <span class="math notranslate nohighlight">\(d\)</span> and the number of users be <span class="math notranslate nohighlight">\(T\)</span>. RLRMC algorithm assumes that the ratings matrix <span class="math notranslate nohighlight">\(M\)</span> (of size <span class="math notranslate nohighlight">\(d\times T\)</span>) is partially known. The entry at <span class="math notranslate nohighlight">\(M(i,j)\)</span> represents the rating given by the <span class="math notranslate nohighlight">\(j\)</span>-th user to the <span class="math notranslate nohighlight">\(i\)</span>-th movie. RLRMC learns matrix <span class="math notranslate nohighlight">\(M\)</span> as <span class="math notranslate nohighlight">\(M=LR^\top\)</span>, where <span class="math notranslate nohighlight">\(L\)</span> is a <span class="math notranslate nohighlight">\(d\times r\)</span> matrix and <span class="math notranslate nohighlight">\(R\)</span> is a <span class="math notranslate nohighlight">\(T\times r\)</span> matrix. Here, <span class="math notranslate nohighlight">\(r\)</span> is the rank hyper-parameter which needs to be provided to the RLRMC algorithm. Typically, it is assumed that <span class="math notranslate nohighlight">\(r\ll d,T\)</span>. The optimization problem is solved iteratively using the the Riemannian conjugate gradients algorithm. The Riemannian optimization framework generalizes a range of Euclidean first- and second-order algorithms such as conjugate gradients, trust-regions, among others, to Riemannian manifolds. A detailed exposition of the Riemannian optimization framework can be found in Absil et al. (2008).</p>
<p>This notebook provides an example of how to utilize and evaluate RLRMC implementation in <strong>recommenders</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">recommenders.datasets.python_splitters</span> <span class="kn">import</span> <span class="n">python_random_split</span>
<span class="kn">from</span> <span class="nn">recommenders.datasets.python_splitters</span> <span class="kn">import</span> <span class="n">python_stratified_split</span>
<span class="kn">from</span> <span class="nn">recommenders.datasets</span> <span class="kn">import</span> <span class="n">movielens</span>
<span class="kn">from</span> <span class="nn">recommenders.models.rlrmc.RLRMCdataset</span> <span class="kn">import</span> <span class="n">RLRMCdataset</span> 
<span class="kn">from</span> <span class="nn">recommenders.models.rlrmc.RLRMCalgorithm</span> <span class="kn">import</span> <span class="n">RLRMCalgorithm</span> 
<span class="c1"># Pymanopt installation is required via</span>
<span class="c1"># pip install pymanopt </span>
<span class="kn">from</span> <span class="nn">recommenders.evaluation.python_evaluation</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">rmse</span><span class="p">,</span> <span class="n">mae</span>
<span class="p">)</span>

<span class="c1"># import logging</span>

<span class="c1"># %load_ext autoreload</span>
<span class="c1"># %autoreload 2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pandas version: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">__version__</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;System version: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Pandas version: 0.23.4
System version: 3.7.1 (default, Dec 14 2018, 13:28:58) 
[Clang 4.0.1 (tags/RELEASE_401/final)]
</pre></div>
</div>
</div>
</div>
<p>Set the default parameters.</p>
<div class="cell tag_parameters docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select Movielens data size: 100k, 1m, 10m, or 20m</span>
<span class="n">MOVIELENS_DATA_SIZE</span> <span class="o">=</span> <span class="s1">&#39;10m&#39;</span>

<span class="c1"># Model parameters</span>

<span class="c1"># rank of the model, a positive integer (usually small), required parameter</span>
<span class="n">rank_parameter</span> <span class="o">=</span> <span class="mi">10</span>
<span class="c1"># regularization parameter multiplied to loss function, a positive number (usually small), required parameter</span>
<span class="n">regularization_parameter</span> <span class="o">=</span> <span class="mf">0.001</span>
<span class="c1"># initialization option for the model, &#39;svd&#39; employs singular value decomposition, optional parameter</span>
<span class="n">initialization_flag</span> <span class="o">=</span> <span class="s1">&#39;svd&#39;</span> <span class="c1">#default is &#39;random&#39;</span>
<span class="c1"># maximum number of iterations for the solver, a positive integer, optional parameter</span>
<span class="n">maximum_iteration</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1">#optional, default is 100</span>
<span class="c1"># maximum time in seconds for the solver, a positive integer, optional parameter</span>
<span class="n">maximum_time</span> <span class="o">=</span> <span class="mi">300</span><span class="c1">#optional, default is 1000</span>

<span class="c1"># Verbosity of the intermediate results</span>
<span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span> <span class="c1">#optional parameter, valid values are 0,1,2, default is 0</span>
<span class="c1"># Whether to compute per iteration train RMSE (and test RMSE, if test data is given)</span>
<span class="n">compute_iter_rmse</span><span class="o">=</span><span class="kc">True</span> <span class="c1">#optional parameter, boolean value, default is False</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Logging utilities. Please import &#39;logging&#39; in order to use the following command. </span>
<span class="c1"># logging.basicConfig(level=logging.INFO)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="download-the-movielens-dataset">
<h2>1. Download the MovieLens dataset<a class="headerlink" href="#download-the-movielens-dataset" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">movielens</span><span class="o">.</span><span class="n">load_pandas_df</span><span class="p">(</span>
    <span class="n">size</span><span class="o">=</span><span class="n">MOVIELENS_DATA_SIZE</span><span class="p">,</span>
    <span class="n">header</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;userID&quot;</span><span class="p">,</span> <span class="s2">&quot;itemID&quot;</span><span class="p">,</span> <span class="s2">&quot;rating&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>65.6MB [00:25, 2.57MB/s]                            
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="split-the-data-using-the-spark-chronological-splitter-provided-in-utilities">
<h2>2. Split the data using the Spark chronological splitter provided in utilities<a class="headerlink" href="#split-the-data-using-the-spark-chronological-splitter-provided-in-utilities" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## If both validation and test sets are required</span>
<span class="c1"># train, validation, test = python_random_split(df,[0.6, 0.2, 0.2])</span>

<span class="c1">## If validation set is not required</span>
<span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">python_random_split</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>

<span class="c1">## If test set is not required</span>
<span class="c1"># train, validation = python_random_split(df,[0.8, 0.2])</span>

<span class="c1">## If both validation and test sets are not required (i.e., the complete dataset is for training the model)</span>
<span class="c1"># train = df</span>
</pre></div>
</div>
</div>
</div>
<p>Generate an RLRMCdataset object from the data subsets.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># data = RLRMCdataset(train=train, validation=validation, test=test)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">RLRMCdataset</span><span class="p">(</span><span class="n">train</span><span class="o">=</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="n">test</span><span class="p">)</span> <span class="c1"># No validation set</span>
<span class="c1"># data = RLRMCdataset(train=train, validation=validation) # No test set</span>
<span class="c1"># data = RLRMCdataset(train=train) # No validation or test set</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="train-the-rlrmc-model-on-the-training-data">
<h2>3. Train the RLRMC model on the training data<a class="headerlink" href="#train-the-rlrmc-model-on-the-training-data" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">RLRMCalgorithm</span><span class="p">(</span><span class="n">rank</span> <span class="o">=</span> <span class="n">rank_parameter</span><span class="p">,</span>
                       <span class="n">C</span> <span class="o">=</span> <span class="n">regularization_parameter</span><span class="p">,</span>
                       <span class="n">model_param</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">model_param</span><span class="p">,</span>
                       <span class="n">initialize_flag</span> <span class="o">=</span> <span class="n">initialization_flag</span><span class="p">,</span>
                       <span class="n">maxiter</span><span class="o">=</span><span class="n">maximum_iteration</span><span class="p">,</span>
                       <span class="n">max_time</span><span class="o">=</span><span class="n">maximum_time</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>

<span class="c1"># fit_and_evaluate will compute RMSE on the validation set (if given) at every iteration</span>
<span class="c1"># model.fit_and_evaluate(data,verbosity=verbosity)</span>

<span class="n">train_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span> <span class="c1"># train_time includes both model initialization and model training time. </span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Took </span><span class="si">{}</span><span class="s2"> seconds for training.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">train_time</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Took 44.991251945495605 seconds for training.
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="obtain-predictions-from-the-rlrmc-model-on-the-test-data">
<h2>4. Obtain predictions from the RLRMC model on the test data<a class="headerlink" href="#obtain-predictions-from-the-rlrmc-model-on-the-test-data" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Obtain predictions on (userID,itemID) pairs (60586,54775) and (52681,36519) in Movielens 10m dataset</span>
<span class="c1"># output = model.predict([60586,52681],[54775,36519]) # Movielens 10m dataset</span>

<span class="c1"># Obtain prediction on the full test set</span>
<span class="n">predictions_ndarr</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;userID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;itemID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="evaluate-how-well-rlrmc-performs">
<h2>5. Evaluate how well RLRMC performs<a class="headerlink" href="#evaluate-how-well-rlrmc-performs" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictions_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;userID&quot;</span><span class="p">:</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;userID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;itemID&quot;</span><span class="p">:</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;itemID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;prediction&quot;</span><span class="p">:</span><span class="n">predictions_ndarr</span><span class="p">})</span>

<span class="c1">## Compute test RMSE </span>
<span class="n">eval_rmse</span> <span class="o">=</span> <span class="n">rmse</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">predictions_df</span><span class="p">)</span>
<span class="c1">## Compute test MAE </span>
<span class="n">eval_mae</span> <span class="o">=</span> <span class="n">mae</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">predictions_df</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RMSE:</span><span class="se">\t</span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">eval_rmse</span><span class="p">,</span>
      <span class="s2">&quot;MAE:</span><span class="se">\t</span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">eval_mae</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE:	0.809386
MAE:	0.620971
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="reference">
<h2>Reference<a class="headerlink" href="#reference" title="Permalink to this headline">¶</a></h2>
<p>[1] Pratik Jawanpuria and Bamdev Mishra. <em>A unified framework for structured low-rank matrix learning</em>. In International Conference on Machine Learning, 2018.</p>
<p>[2] Bamdev Mishra, Gilles Meyer, Francis Bach, and Rodolphe Sepulchre. <em>Low-rank optimization with trace norm penalty</em>. In SIAM Journal on Optimization 23(4):2124-2149, 2013.</p>
<p>[3] James Townsend, Niklas Koep, and Sebastian Weichwald. <em>Pymanopt: A Python Toolbox for Optimization on Manifolds using Automatic Differentiation</em>. In Journal of Machine Learning Research 17(137):1-5, 2016.</p>
<p>[4] P.-A. Absil, R. Mahony, and R. Sepulchre. <em>Optimization Algorithms on Matrix Manifolds</em>. Princeton University Press, Princeton, NJ, 2008.</p>
<p>[5] A. Edelman, T. Arias, and S. Smith. <em>The geometry of algo- rithms with orthogonality constraints</em>. SIAM Journal on Matrix Analysis and Applications, 20(2):303–353, 1998.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./examples/00_quick_start"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By The Jupyter Book community<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>